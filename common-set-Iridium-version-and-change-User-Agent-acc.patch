From cfa831711c8c7d20dac14f2e6b0a69bdde04d4d8 Mon Sep 17 00:00:00 2001
From: Jan Engelhardt <jengelh@inai.de>
Date: Sun, 24 May 2015 15:08:18 +0200
Subject: [PATCH 46/46] common: set Iridium version and change User-Agent
 accordingly

Reduced version number:
We do not use @BUILD@ or @PATCH@, in particular not in the User-Agent
string.

As for the user agent, continue providing Chrome/* for possible
compatibility checks by the browser and/or websites, since we
really are still Chromium.

Note to self:
Update "Chromium/*" in UA string when updating chrome/version.
---
 android_webview/common/aw_version_info_values.h.version | 2 +-
 chrome/VERSION                                          | 6 +++---
 chrome/common/chrome_version_info.cc                    | 2 +-
 chrome/common/chrome_version_info_values.h.version      | 2 +-
 content/common/user_agent.cc                            | 2 ++
 extensions/shell/common/version.h.in                    | 2 +-
 6 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/android_webview/common/aw_version_info_values.h.version b/android_webview/common/aw_version_info_values.h.version
index 72faf97..7c0f43d 100644
--- a/android_webview/common/aw_version_info_values.h.version
+++ b/android_webview/common/aw_version_info_values.h.version
@@ -5,6 +5,6 @@
 #ifndef ANDROID_WEBVIEW_COMMON_AW_VERSION_INFO_VALUES_H_
 #define ANDROID_WEBVIEW_COMMON_AW_VERSION_INFO_VALUES_H_
 
-#define PRODUCT_VERSION "@MAJOR@.@MINOR@.@BUILD@.@PATCH@"
+#define PRODUCT_VERSION "@MAJOR@.@MINOR@"
 
 #endif  // ANDROID_WEBVIEW_COMMON_AW_VERSION_INFO_VALUES_H_
diff --git a/chrome/VERSION b/chrome/VERSION
index 4187657..c560041 100644
--- a/chrome/VERSION
+++ b/chrome/VERSION
@@ -1,4 +1,4 @@
 MAJOR=43
-MINOR=0
-BUILD=2357
-PATCH=83
+MINOR=1
+BUILD=0
+PATCH=0
diff --git a/chrome/common/chrome_version_info.cc b/chrome/common/chrome_version_info.cc
index 48c0791..2793492 100644
--- a/chrome/common/chrome_version_info.cc
+++ b/chrome/common/chrome_version_info.cc
@@ -18,7 +18,7 @@
 namespace chrome {
 
 std::string VersionInfo::ProductNameAndVersionForUserAgent() const {
-  return "Chrome/" + Version();
+  return "Iridium/" + Version();
 }
 
 VersionInfo::VersionInfo() {
diff --git a/chrome/common/chrome_version_info_values.h.version b/chrome/common/chrome_version_info_values.h.version
index dde5a42..26f350a 100644
--- a/chrome/common/chrome_version_info_values.h.version
+++ b/chrome/common/chrome_version_info_values.h.version
@@ -6,7 +6,7 @@
 #define CHROME_COMMON_CHROME_VERSION_INFO_VALUES_H_
 
 #define PRODUCT_NAME "@PRODUCT_FULLNAME@"
-#define PRODUCT_VERSION "@MAJOR@.@MINOR@.@BUILD@.@PATCH@"
+#define PRODUCT_VERSION "@MAJOR@.@MINOR@"
 #define LAST_CHANGE "@LASTCHANGE@"
 #define IS_OFFICIAL_BUILD @OFFICIAL_BUILD@
 
diff --git a/content/common/user_agent.cc b/content/common/user_agent.cc
index f3e113d..83626d1 100644
--- a/content/common/user_agent.cc
+++ b/content/common/user_agent.cc
@@ -209,6 +209,8 @@ std::string BuildUserAgentFromOSAndProduct(const std::string& os_info,
       product.c_str(),
       WEBKIT_VERSION_MAJOR,
       WEBKIT_VERSION_MINOR);
+  if (strncmp(product.c_str(), "Iridium/", 8) == 0)
+  	base::StringAppendF(&user_agent, " Chrome/43.0.2357.84");
   return user_agent;
 }
 
diff --git a/extensions/shell/common/version.h.in b/extensions/shell/common/version.h.in
index c4627fe..bf7d274 100644
--- a/extensions/shell/common/version.h.in
+++ b/extensions/shell/common/version.h.in
@@ -7,7 +7,7 @@
 #ifndef EXTENSIONS_SHELL_COMMON_VERSION_H_
 #define EXTENSIONS_SHELL_COMMON_VERSION_H_
 
-#define PRODUCT_VERSION "@MAJOR@.@MINOR@.@BUILD@.@PATCH@"
+#define PRODUCT_VERSION "@MAJOR@.@MINOR@"
 #define LAST_CHANGE "@LASTCHANGE@"
 
 #endif  // EXTENSIONS_SHELL_COMMON_VERSION_H_
-- 
2.4.0


From 38b2c9e4764b4998f2472f5c2b985ea216fd9e53 Mon Sep 17 00:00:00 2001
From: Jan Engelhardt <jengelh@inai.de>
Date: Thu, 20 Apr 2017 16:25:49 +0200
Subject: [PATCH 01/76] build: remove calling untrusted hooks

Avoid downloading untrusted executables and wasting time with a
sysroot.
---
 DEPS | 38 +++++++++++++++++++++-----------------
 1 file changed, 21 insertions(+), 17 deletions(-)

diff --git DEPS DEPS
index 30795f6cd6bf3..509905e94fcd5 100644
--- DEPS
+++ DEPS
@@ -86,7 +86,7 @@ vars = {
 
   # Check out and download nacl by default. This can be disabled e.g. with
   # custom_vars.
-  'checkout_nacl': True,
+  'checkout_nacl': False,
 
   # By default, do not check out src-internal. This can be overridden e.g. with
   # custom_vars.
@@ -116,8 +116,8 @@ vars = {
   # support for other platforms may be added in the future.
   'checkout_openxr' : 'checkout_win',
 
-  'checkout_traffic_annotation_tools': 'checkout_configuration != "small"',
-  'checkout_instrumented_libraries': 'checkout_linux and checkout_configuration != "small"',
+  'checkout_traffic_annotation_tools': False,
+  'checkout_instrumented_libraries': False,
 
   # By default bot checkouts the WPR archive files only when this
   # flag is set True.
@@ -4173,35 +4173,35 @@ hooks = [
   {
     'name': 'sysroot_arm',
     'pattern': '.',
-    'condition': 'checkout_linux and checkout_arm',
+    'condition': False,
     'action': ['python', 'src/build/linux/sysroot_scripts/install-sysroot.py',
                '--arch=arm'],
   },
   {
     'name': 'sysroot_arm64',
     'pattern': '.',
-    'condition': 'checkout_linux and checkout_arm64',
+    'condition': False,
     'action': ['python', 'src/build/linux/sysroot_scripts/install-sysroot.py',
                '--arch=arm64'],
   },
   {
     'name': 'sysroot_x86',
     'pattern': '.',
-    'condition': 'checkout_linux and (checkout_x86 or checkout_x64)',
+    'condition': False,
     'action': ['python', 'src/build/linux/sysroot_scripts/install-sysroot.py',
                '--arch=x86'],
   },
   {
     'name': 'sysroot_mips',
     'pattern': '.',
-    'condition': 'checkout_linux and checkout_mips',
+    'condition': False,
     'action': ['python', 'src/build/linux/sysroot_scripts/install-sysroot.py',
                '--arch=mips'],
   },
   {
     'name': 'sysroot_mips64',
     'pattern': '.',
-    'condition': 'checkout_linux and checkout_mips64',
+    'condition': False,
     'action': ['python', 'src/build/linux/sysroot_scripts/install-sysroot.py',
                '--arch=mips64el'],
   },
@@ -4209,7 +4209,7 @@ hooks = [
   {
     'name': 'sysroot_x64',
     'pattern': '.',
-    'condition': 'checkout_linux and checkout_x64',
+    'condition': False,
     'action': ['python', 'src/build/linux/sysroot_scripts/install-sysroot.py',
                '--arch=x64'],
   },
@@ -4246,7 +4246,7 @@ hooks = [
     # Note: On Win, this should run after win_toolchain, as it may use it.
     'name': 'clang',
     'pattern': '.',
-    'condition': 'not llvm_force_head_revision',
+    'condition': False,
     'action': ['python', 'src/tools/clang/scripts/update.py'],
   },
   {
@@ -4254,7 +4254,7 @@ hooks = [
     # Note: On Win, this should run after win_toolchain, as it may use it.
     'name': 'clang_tot',
     'pattern': '.',
-    'condition': 'llvm_force_head_revision',
+    'condition': False,
     'action': ['python', 'src/tools/clang/scripts/build.py',
                '--llvm-force-head-revision',
                '--with-android={checkout_android}'],
@@ -4263,7 +4263,7 @@ hooks = [
     # This is supposed to support the same set of platforms as 'clang' above.
     'name': 'clang_coverage',
     'pattern': '.',
-    'condition': 'checkout_clang_coverage_tools',
+    'condition': False,
     'action': ['python', 'src/tools/clang/scripts/update.py',
                '--package=coverage_tools'],
   },
@@ -4376,7 +4376,7 @@ hooks = [
   {
     'name': 'rc_linux',
     'pattern': '.',
-    'condition': 'checkout_win and host_os == "linux"',
+    'condition': False,
     'action': [ 'python',
                 'src/third_party/depot_tools/download_from_google_storage.py',
                 '--no_resume',
@@ -4388,6 +4388,7 @@ hooks = [
  {
     'name': 'test_fonts',
     'pattern': '.',
+    'condition': False,
     'action': [ 'download_from_google_storage',
                 '--no_resume',
                 '--extract',
@@ -4400,6 +4401,7 @@ hooks = [
   {
     'name': 'opus_test_files',
     'pattern': '.',
+    'condition': False,
     'action': ['download_from_google_storage',
                '--no_auth',
                '--quiet',
@@ -4453,7 +4455,7 @@ hooks = [
   {
     'name': 'msan_chained_origins',
     'pattern': '.',
-    'condition': 'checkout_instrumented_libraries',
+    'condition': False,
     'action': [ 'python',
                 'src/third_party/depot_tools/download_from_google_storage.py',
                 '--no_resume',
@@ -4465,7 +4467,7 @@ hooks = [
   {
     'name': 'msan_no_origins',
     'pattern': '.',
-    'condition': 'checkout_instrumented_libraries',
+    'condition': False,
     'action': [ 'python',
                 'src/third_party/depot_tools/download_from_google_storage.py',
                 '--no_resume',
@@ -4477,6 +4479,7 @@ hooks = [
   {
     'name': 'wasm_fuzzer',
     'pattern': '.',
+    'condition': False,
     'action': [ 'python',
                 'src/third_party/depot_tools/download_from_google_storage.py',
                 '--no_resume',
@@ -4491,7 +4494,7 @@ hooks = [
   {
     'name': 'node_linux64',
     'pattern': '.',
-    'condition': 'host_os == "linux"',
+    'condition': False,
     'action': [ 'python',
                 'src/third_party/depot_tools/download_from_google_storage.py',
                 '--no_resume',
@@ -4598,6 +4601,7 @@ hooks = [
   {
     'name': 'zucchini_testdata',
     'pattern': '.',
+    'condition': False,
     'action': [ 'python',
                 'src/third_party/depot_tools/download_from_google_storage.py',
                 '--no_resume',
@@ -4631,7 +4635,7 @@ hooks = [
   {
     'name': 'Fetch Android AFDO profile',
     'pattern': '.',
-    'condition': 'checkout_android or checkout_linux',
+    'condition': False,
     'action': [ 'vpython',
                 'src/tools/download_optimization_profile.py',
                 '--newest_state=src/chrome/android/profiles/newest.txt',
-- 
2.29.1


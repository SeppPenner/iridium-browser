From 10607238502fdb94601496a05f036369897fd42a Mon Sep 17 00:00:00 2001
From: Jan Engelhardt <jengelh@inai.de>
Date: Thu, 20 Apr 2017 16:25:49 +0200
Subject: [PATCH 01/58] build: remove calling untrusted hooks

Avoid downloading untrusted executables and wasting time with a
sysroot.
---
 DEPS | 290 +------------------------------------------------------------------
 1 file changed, 3 insertions(+), 287 deletions(-)

diff --git a/DEPS b/DEPS
index 53179640f31e..b766a175914d 100644
--- a/DEPS
+++ b/DEPS
@@ -17,16 +17,14 @@ vars = {
     'bbedc54bc5cfdf16fdb979babb6b5a635049e740',
   'checkout_configuration':
     'default',
-  'checkout_instrumented_libraries':
-    'checkout_linux and checkout_configuration == "default"',
+  'checkout_instrumented_libraries': False,
   'checkout_libaom': True,
-  'checkout_nacl': True,
+  'checkout_nacl': False,
   'checkout_oculus_sdk':
     'checkout_src_internal and checkout_win',
   'checkout_src_internal': False,
   'checkout_telemetry_dependencies': False,
-  'checkout_traffic_annotation_tools':
-    'checkout_configuration == "default"',
+  'checkout_traffic_annotation_tools': False,
   'chromium_git':
     'https://chromium.googlesource.com',
   'devtools_node_modules_revision':
@@ -643,105 +641,6 @@ hooks = [
     'name':
       'remove_stale_pyc_files'
   },
-  {
-    'action': [
-      'python',
-      'src/build/download_nacl_toolchains.py',
-      '--mode',
-      'nacl_core_sdk',
-      'sync',
-      '--extract'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'nacltools',
-    'condition':
-      'checkout_nacl'
-  },
-  {
-    'action': [
-      'python',
-      'src/build/linux/sysroot_scripts/install-sysroot.py',
-      '--arch=arm'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'sysroot_arm',
-    'condition':
-      'checkout_linux and checkout_arm'
-  },
-  {
-    'action': [
-      'python',
-      'src/build/linux/sysroot_scripts/install-sysroot.py',
-      '--arch=arm64'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'sysroot_arm64',
-    'condition':
-      'checkout_linux and checkout_arm64'
-  },
-  {
-    'action': [
-      'python',
-      'src/build/linux/sysroot_scripts/install-sysroot.py',
-      '--arch=x86'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'sysroot_x86',
-    'condition':
-      'checkout_linux and (checkout_x86 or checkout_x64)'
-  },
-  {
-    'action': [
-      'python',
-      'src/build/linux/sysroot_scripts/install-sysroot.py',
-      '--arch=mips'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'sysroot_mips',
-    'condition':
-      'checkout_linux and checkout_mips'
-  },
-  {
-    'action': [
-      'python',
-      'src/build/linux/sysroot_scripts/install-sysroot.py',
-      '--arch=x64'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'sysroot_x64',
-    'condition':
-      'checkout_linux and checkout_x64'
-  },
-  {
-    'action': [
-      'python',
-      'src/third_party/depot_tools/download_from_google_storage.py',
-      '--no_resume',
-      '--no_auth',
-      '--bucket',
-      'chromium-browser-clang/ciopfs',
-      '-s',
-      'src/build/ciopfs.sha1'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'ciopfs_linux',
-    'condition':
-      'checkout_win and host_os == "linux"'
-  },
   {
     'action': [
       'python',
@@ -768,28 +667,6 @@ hooks = [
     'condition':
       'checkout_ios or checkout_mac'
   },
-  {
-    'action': [
-      'python',
-      'src/third_party/binutils/download.py'
-    ],
-    'pattern':
-      'src/third_party/binutils',
-    'name':
-      'binutils',
-    'condition':
-      'host_os == "linux"'
-  },
-  {
-    'action': [
-      'python',
-      'src/tools/clang/scripts/update.py'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'clang'
-  },
   {
     'action': [
       'python',
@@ -881,24 +758,6 @@ hooks = [
     'condition':
       'host_os == "mac"'
   },
-  {
-    'action': [
-      'python',
-      'src/third_party/depot_tools/download_from_google_storage.py',
-      '--no_resume',
-      '--no_auth',
-      '--bucket',
-      'chromium-gn',
-      '-s',
-      'src/buildtools/linux64/gn.sha1'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'gn_linux64',
-    'condition':
-      'host_os == "linux"'
-  },
   {
     'action': [
       'python',
@@ -935,24 +794,6 @@ hooks = [
     'condition':
       'host_os == "mac"'
   },
-  {
-    'action': [
-      'python',
-      'src/third_party/depot_tools/download_from_google_storage.py',
-      '--no_resume',
-      '--no_auth',
-      '--bucket',
-      'chromium-clang-format',
-      '-s',
-      'src/buildtools/linux64/clang-format.sha1'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'clang_format_linux',
-    'condition':
-      'host_os == "linux"'
-  },
   {
     'action': [
       'python',
@@ -989,42 +830,6 @@ hooks = [
     'condition':
       'checkout_win and host_os == "mac"'
   },
-  {
-    'action': [
-      'python',
-      'src/third_party/depot_tools/download_from_google_storage.py',
-      '--no_resume',
-      '--no_auth',
-      '--bucket',
-      'chromium-browser-clang/rc',
-      '-s',
-      'src/build/toolchain/win/rc/linux64/rc.sha1'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'rc_linux',
-    'condition':
-      'checkout_win and host_os == "linux"'
-  },
-  {
-    'action': [
-      'download_from_google_storage',
-      '--no_resume',
-      '--extract',
-      '--no_auth',
-      '--bucket',
-      'chromium-fonts',
-      '-s',
-      'src/third_party/content_shell_fonts/content_shell_test_fonts.tar.gz.sha1'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'content_shell_fonts',
-    'condition':
-      'checkout_linux or (checkout_android or checkout_fuchsia)'
-  },
   {
     'action': [
       'python',
@@ -1079,24 +884,6 @@ hooks = [
     'condition':
       'host_os == "mac"'
   },
-  {
-    'action': [
-      'python',
-      'src/third_party/depot_tools/download_from_google_storage.py',
-      '--no_resume',
-      '--no_auth',
-      '--bucket',
-      'chromium-luci',
-      '-d',
-      'src/tools/luci-go/linux64'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'luci-go_linux',
-    'condition':
-      'host_os == "linux"'
-  },
   {
     'action': [
       'python',
@@ -1169,42 +956,6 @@ hooks = [
     'condition':
       'checkout_instrumented_libraries'
   },
-  {
-    'action': [
-      'python',
-      'src/third_party/depot_tools/download_from_google_storage.py',
-      '--no_resume',
-      '--no_auth',
-      '-u',
-      '--bucket',
-      'v8-wasm-fuzzer',
-      '-s',
-      'src/v8/test/fuzzer/wasm_corpus.tar.gz.sha1'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'wasm_fuzzer'
-  },
-  {
-    'action': [
-      'python',
-      'src/third_party/depot_tools/download_from_google_storage.py',
-      '--no_resume',
-      '--extract',
-      '--no_auth',
-      '--bucket',
-      'chromium-nodejs/8.9.1',
-      '-s',
-      'src/third_party/node/linux/node-linux-x64.tar.gz.sha1'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'node_linux64',
-    'condition':
-      'host_os == "linux"'
-  },
   {
     'action': [
       'python',
@@ -1335,23 +1086,6 @@ hooks = [
     'condition':
       'host_os == "win" and checkout_traffic_annotation_tools'
   },
-  {
-    'action': [
-      'python',
-      'src/third_party/depot_tools/download_from_google_storage.py',
-      '--no_resume',
-      '--no_auth',
-      '--num_threads=4',
-      '--bucket',
-      'chromium-binary-patching',
-      '-d',
-      'src/chrome/installer/zucchini/testdata'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'zucchini_testdata'
-  },
   {
     'action': [
       'python',
@@ -1404,24 +1138,6 @@ hooks = [
     'condition':
       'checkout_android'
   },
-  {
-    'action': [
-      'python',
-      'src/third_party/depot_tools/download_from_google_storage.py',
-      '--no_resume',
-      '--no_auth',
-      '--bucket',
-      'chromium-android-tools/checkstyle',
-      '-s',
-      'src/third_party/checkstyle/checkstyle-8.0-all.jar.sha1'
-    ],
-    'pattern':
-      '.',
-    'name':
-      'checkstyle',
-    'condition':
-      'checkout_android or checkout_linux'
-  },
   {
     'action': [
       'python',
-- 
2.16.3


From 0bb0cdffd68c218f2fabb2fe9a8a4d573ad00107 Mon Sep 17 00:00:00 2001
From: Jan Engelhardt <jengelh@inai.de>
Date: Thu, 30 Nov 2017 15:56:12 +0100
Subject: [PATCH 04/60] doc: add note to self on build procedure

---
 BUILD-IRID.txt | 31 +++++++++++++++++++++++++++++++
 1 file changed, 31 insertions(+)
 create mode 100644 BUILD-IRID.txt

diff --git a/BUILD-IRID.txt b/BUILD-IRID.txt
new file mode 100644
index 0000000000000..50d09940dbd4f
--- /dev/null
+++ b/BUILD-IRID.txt
@@ -0,0 +1,31 @@
+basic test that the patches build
+
+1.
+"DEPS" contains a commit hash for WebRTC which `gclient sync` does not
+download, because that commit is not on a branch. Do it manually:
+ cd third_party/webrtc/
+ git ls-remote origin | grep 0b2302e5e0418b6716fbc0b3927874fd3a842caf
+   abcdef...   refs/branch-heads/m78
+ git fetch origin refs/branch-heads/m78
+ git reset --hard FETCH_HEAD
+
+2. gclient sync
+
+3. export CC=gcc CXX=g++ AR=ar NM=nm
+
+4.
+mkdir -p third_party/node/linux/node-linux-x64/bin
+ln -s /usr/bin/node third_party/node/linux/node-linux-x64/bin/
+
+5.
+gn gen '--args= custom_toolchain="//build/toolchain/linux/unbundle:default" host_toolchain="//build/toolchain/linux/unbundle:default" linux_use_bundled_binutils=false use_custom_libcxx=false is_debug=false enable_nacl=false use_swiftshader_with_subzero=true is_component_ffmpeg=true use_cups=true use_aura=true use_jumbo_build=true jumbo_file_merge_limit=8 enable_swiftshader=false concurrent_links=1 symbol_level=1 blink_symbol_level=0 use_kerberos=true enable_vr=false optimize_webui=false enable_reading_list=false use_pulseaudio=true link_pulseaudio=true is_component_build=false use_sysroot=false fatal_linker_warnings=false use_allocator="tcmalloc" fieldtrial_testing_like_official_build=true use_gold=true use_gnome_keyring=false                                     use_lld=false use_vaapi=true use_sysroot=false treat_warnings_as_errors=false enable_widevine=false use_dbus=true use_system_harfbuzz=true use_system_freetype=true enable_hangout_services_extension=true enable_vulkan=true enable_hevc_demuxing=true rtc_use_pipewire=true rtc_link_pipewire=true use_vaapi=true is_clang=false              proprietary_codecs=true ffmpeg_branding="Chrome"' out/Release
+
+6.
+LD_LIBRARY_PATH=$PWD/out/Release ninja -C out/Release chrome chrome_sandbox chromedriver
+
+(6a.) LD_LIBRARY_PATH is used to avoid this error during ninja:
+[1/8] ACTION //tools/v8_context_snapshot:generate_v8_context_snapshot(//build/toolchain/linux/unbundle:default)
+FAILED: v8_context_snapshot.bin
+python ../../build/gn_run_binary.py ./v8_context_snapshot_generator --output_file=v8_context_snapshot.bin
+v8_context_snapshot_generator: error while loading shared libraries: libffmpeg.so: cannot open shared object file: No such file or directory
+v8_context_snapshot_generator failed with exit code 127
-- 
2.23.0


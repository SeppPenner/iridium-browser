From cd61f5ccc879424685e711bddc33d93ab4f13316 Mon Sep 17 00:00:00 2001
From: Jan Engelhardt <jengelh@inai.de>
Date: Wed, 8 Jul 2015 15:08:32 +0200
Subject: [PATCH 61/61] common: set Iridium version / User-Agent

---
 chrome/VERSION                                            | 8 ++++----
 components/version_info/version_info.cc                   | 4 +++-
 components/version_info/version_info_values.h.version     | 2 +-
 content/common/user_agent.cc                              | 2 ++
 extensions/shell/common/version.h.in                      | 2 +-
 tools/metrics/histograms/extract_histograms.py            | 2 +-
 .../histograms/generate_expired_histograms_array.py       | 4 ++--
 7 files changed, 14 insertions(+), 10 deletions(-)

diff --git a/chrome/VERSION b/chrome/VERSION
index c1d12649b3d01..fa99511d12779 100644
--- a/chrome/VERSION
+++ b/chrome/VERSION
@@ -1,4 +1,4 @@
-MAJOR=80
-MINOR=0
-BUILD=3987
-PATCH=149
+MAJOR=2020
+MINOR=03
+BUILD=80
+PATCH=0
diff --git a/components/version_info/version_info.cc b/components/version_info/version_info.cc
index 57cf7a7fef9de..b0f99859c3180 100644
--- a/components/version_info/version_info.cc
+++ b/components/version_info/version_info.cc
@@ -16,7 +16,9 @@
 namespace version_info {
 
 std::string GetProductNameAndVersionForUserAgent() {
-  return "Chrome/" + GetVersionNumber();
+  /* Currently, the Iridium install base is so small that it would make us rather identifiable if we had our own tag. */
+	return "Chrome/80.0.3987.116";
+//  return "Iridium/" + GetVersionNumber();
 }
 
 std::string GetProductName() {
diff --git a/components/version_info/version_info_values.h.version b/components/version_info/version_info_values.h.version
index 6232e359ef20f..3cf4fee096c06 100644
--- a/components/version_info/version_info_values.h.version
+++ b/components/version_info/version_info_values.h.version
@@ -6,7 +6,7 @@
 #define COMPONENTS_VERSION_INFO_VERSION_INFO_VALUES_H_
 
 #define PRODUCT_NAME "@PRODUCT_FULLNAME@"
-#define PRODUCT_VERSION "@MAJOR@.@MINOR@.@BUILD@.@PATCH@"
+#define PRODUCT_VERSION "@MAJOR@.@MINOR@"
 #define LAST_CHANGE "@LASTCHANGE@"
 #define IS_OFFICIAL_BUILD @OFFICIAL_BUILD@
 
diff --git a/content/common/user_agent.cc b/content/common/user_agent.cc
index 37e72394997a0..9ef834d76552d 100644
--- a/content/common/user_agent.cc
+++ b/content/common/user_agent.cc
@@ -200,6 +200,8 @@ std::string BuildUserAgentFromOSAndProduct(const std::string& os_info,
       product.c_str(),
       WEBKIT_VERSION_MAJOR,
       WEBKIT_VERSION_MINOR);
+  if (strncmp(product.c_str(), "Chrome/", 7) != 0)
+	base::StringAppendF(&user_agent, " Chrome/80.0.3987.149");
   return user_agent;
 }
 
diff --git a/extensions/shell/common/version.h.in b/extensions/shell/common/version.h.in
index c4627fe512a1b..bf7d27484e997 100644
--- a/extensions/shell/common/version.h.in
+++ b/extensions/shell/common/version.h.in
@@ -7,7 +7,7 @@
 #ifndef EXTENSIONS_SHELL_COMMON_VERSION_H_
 #define EXTENSIONS_SHELL_COMMON_VERSION_H_
 
-#define PRODUCT_VERSION "@MAJOR@.@MINOR@.@BUILD@.@PATCH@"
+#define PRODUCT_VERSION "@MAJOR@.@MINOR@"
 #define LAST_CHANGE "@LASTCHANGE@"
 
 #endif  // EXTENSIONS_SHELL_COMMON_VERSION_H_
diff --git a/tools/metrics/histograms/extract_histograms.py b/tools/metrics/histograms/extract_histograms.py
index fdb9b6d524457..42eaada2c4015 100644
--- a/tools/metrics/histograms/extract_histograms.py
+++ b/tools/metrics/histograms/extract_histograms.py
@@ -80,7 +80,7 @@ DEFAULT_BASE_HISTOGRAM_OBSOLETE_REASON = (
     'Base histogram. Use suffixes of this histogram instead.')
 
 EXPIRY_DATE_PATTERN = "%Y-%m-%d"
-EXPIRY_MILESTONE_RE = re.compile(r'M[0-9]{2,3}\Z')
+EXPIRY_MILESTONE_RE = re.compile(r'M[0-9]{2,4}\Z')
 
 
 _ELEMENT_NODE = xml.dom.minidom.Node.ELEMENT_NODE
diff --git a/tools/metrics/histograms/generate_expired_histograms_array.py b/tools/metrics/histograms/generate_expired_histograms_array.py
index 423f9e2d0a0c7..ae67ef294abb3 100755
--- a/tools/metrics/histograms/generate_expired_histograms_array.py
+++ b/tools/metrics/histograms/generate_expired_histograms_array.py
@@ -15,8 +15,8 @@ import extract_histograms
 import merge_xml
 
 _DATE_FILE_RE = re.compile(r".*MAJOR_BRANCH_DATE=(.+).*")
-_CURRENT_MILESTONE_RE = re.compile(r"MAJOR=([0-9]{2,3})\n")
-_MILESTONE_EXPIRY_RE = re.compile(r"\AM([0-9]{2,3})")
+_CURRENT_MILESTONE_RE = re.compile(r"MAJOR=([0-9]{2,4})\n")
+_MILESTONE_EXPIRY_RE = re.compile(r"\AM([0-9]{2,4})")
 
 _SCRIPT_NAME = "generate_expired_histograms_array.py"
 _HASH_DATATYPE = "uint64_t"
-- 
2.25.1


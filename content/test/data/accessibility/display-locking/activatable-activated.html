<!--
@BLINK-ALLOW:offscreen
@WAIT-FOR:Done
-->
<div id=target aria-label="Working">
  <div id="locked" style="subtree-visibility: auto">
    <div>child</div>
    <div id="nested" style="subtree-visibility: auto">nested locked element!</div>
    <div id="nonActivatable" style="subtree-visibility: hidden">nested non activatable locked element</div>
  </div>
</div>

<script>
async function runTest() {
  // Force layout, then activate.
  locked.getBoundingClientRect();
  locked.scrollIntoView();
  // Double-rAF to ensure that both the outer and nested elements have enough
  // time to process intersection observations.
  requestAnimationFrame(
    () => requestAnimationFrame(
      () => target.setAttribute("aria-label", "Done")));
}
onload = () => requestAnimationFrame(runTest);
</script>

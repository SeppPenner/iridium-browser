From cebb36e36a7b08aded402aea101686a0086849bb Mon Sep 17 00:00:00 2001
From: Jan Engelhardt <jengelh@inai.de>
Date: Sun, 9 Nov 2014 01:54:27 +0100
Subject: [PATCH 47/57] promo: disable Google promotion fetching

Documentation is scarce, and sprinkled with misleading acronyms.
NTP is not NTP, for example. FWIW:

// A PromoResourceService fetches data from a web resource server to
// be used to dynamically change the appearance of the New Tab Page.
// For example, it has been used to fetch "tips" to be displayed on
// the NTP, or to display promotional messages to certain groups of
// Chrome users.

Whatever it is that it downloads, deactivate the one that leads to
Google.

References: https://github.com/iridium-browser/iridium-browser/issues/33
---
 chrome/browser/signin/signin_promo.cc          | 5 +++--
 components/web_resource/notification_promo.cc  | 2 +-
 ios/chrome/browser/application_context_impl.cc | 4 +++-
 3 files changed, 7 insertions(+), 4 deletions(-)

diff --git a/chrome/browser/signin/signin_promo.cc b/chrome/browser/signin/signin_promo.cc
index b3a8bef..43b8e0d 100644
--- a/chrome/browser/signin/signin_promo.cc
+++ b/chrome/browser/signin/signin_promo.cc
@@ -109,6 +109,7 @@ bool ShouldShowPromo(Profile* profile) {
 
 bool ShouldShowPromoAtStartup(Profile* profile, bool is_new_profile) {
   DCHECK(profile);
+  return false;
 
   // Don't show if the profile is an incognito.
   if (profile->IsOffTheRecord())
@@ -353,8 +354,8 @@ void ForceWebBasedSigninFlowForTesting(bool force) {
 void RegisterProfilePrefs(
     user_prefs::PrefRegistrySyncable* registry) {
   registry->RegisterIntegerPref(prefs::kSignInPromoStartupCount, 0);
-  registry->RegisterBooleanPref(prefs::kSignInPromoUserSkipped, false);
-  registry->RegisterBooleanPref(prefs::kSignInPromoShowOnFirstRunAllowed, true);
+  registry->RegisterBooleanPref(prefs::kSignInPromoUserSkipped, true);
+  registry->RegisterBooleanPref(prefs::kSignInPromoShowOnFirstRunAllowed, false);
   registry->RegisterBooleanPref(prefs::kSignInPromoShowNTPBubble, false);
 }
 
diff --git a/components/web_resource/notification_promo.cc b/components/web_resource/notification_promo.cc
index f0e9e71..db556e4 100644
--- a/components/web_resource/notification_promo.cc
+++ b/components/web_resource/notification_promo.cc
@@ -34,7 +34,7 @@ namespace {
 
 const int kDefaultGroupSize = 100;
 
-const char promo_server_url[] = "https://clients3.google.com/crsignal/client";
+const char promo_server_url[] = "trk:122:about:blank";
 
 // The name of the preference that stores the promotion object.
 const char kPrefPromoObject[] = "promo";
diff --git a/ios/chrome/browser/application_context_impl.cc b/ios/chrome/browser/application_context_impl.cc
index eee2f06..723ee82 100644
--- a/ios/chrome/browser/application_context_impl.cc
+++ b/ios/chrome/browser/application_context_impl.cc
@@ -1,4 +1,4 @@
-// Copyright 2014 The Chromium Authors. All rights reserved.
+\// Copyright 2014 The Chromium Authors. All rights reserved.
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
 
@@ -116,7 +116,9 @@ void ApplicationContextImpl::PreMainMessageLoopRun() {
         GetLocalState(), ::GetChannel(), GetApplicationLocale(),
         GetSystemURLRequestContext(), kDummyDisableBackgroundNetworking,
         web_resource::GetIOSChromeParseJSONCallback()));
+#if 0
     promo_resource_service_->StartAfterDelay();
+#endif
   }
 }
 
-- 
2.6.2


From 4dfa8ed0814040317cb82d8545502186daa0a204 Mon Sep 17 00:00:00 2001
From: Jan Engelhardt <jengelh@inai.de>
Date: Tue, 7 Jul 2015 17:02:09 +0200
Subject: [PATCH 62/76] safe_browsing: disable incident reporting

Disables the safebrowsing incident reporting where you could upload
information about a blocked URL to Google (also added a trk prefix to
the URL so we get notified if this happens again in the future).
---
 .../incident_reporting/incident_report_uploader_impl.cc        | 2 +-
 .../incident_reporting/incident_reporting_service.cc           | 3 +++
 chrome/browser/safe_browsing/safe_browsing_blocking_page.cc    | 3 +--
 chrome/browser/safe_browsing/safe_browsing_service.cc          | 2 +-
 .../security_interstitials/core/safe_browsing_loud_error_ui.cc | 1 +
 5 files changed, 7 insertions(+), 4 deletions(-)

diff --git chrome/browser/safe_browsing/incident_reporting/incident_report_uploader_impl.cc chrome/browser/safe_browsing/incident_reporting/incident_report_uploader_impl.cc
index 74fe066d39492..24a1c54ad7c0b 100644
--- chrome/browser/safe_browsing/incident_reporting/incident_report_uploader_impl.cc
+++ chrome/browser/safe_browsing/incident_reporting/incident_report_uploader_impl.cc
@@ -22,7 +22,7 @@ namespace safe_browsing {
 namespace {
 
 const char kSbIncidentReportUrl[] =
-    "https://sb-ssl.google.com/safebrowsing/clientreport/incident";
+    "trk:268:https://sb-ssl.google.com/safebrowsing/clientreport/incident";
 
 constexpr net::NetworkTrafficAnnotationTag
     kSafeBrowsingIncidentTrafficAnnotation =
diff --git chrome/browser/safe_browsing/incident_reporting/incident_reporting_service.cc chrome/browser/safe_browsing/incident_reporting/incident_reporting_service.cc
index b12350930163f..104502029b796 100644
--- chrome/browser/safe_browsing/incident_reporting/incident_reporting_service.cc
+++ chrome/browser/safe_browsing/incident_reporting/incident_reporting_service.cc
@@ -302,11 +302,14 @@ IncidentReportingService::UploadContext::~UploadContext() {
 
 // static
 bool IncidentReportingService::IsEnabledForProfile(Profile* profile) {
+  return false;
+#if 0
   if (profile->IsOffTheRecord())
     return false;
   if (!IsSafeBrowsingEnabled(*profile->GetPrefs()))
     return false;
   return IsExtendedReportingEnabled(*profile->GetPrefs());
+#endif
 }
 
 IncidentReportingService::IncidentReportingService(
diff --git chrome/browser/safe_browsing/safe_browsing_blocking_page.cc chrome/browser/safe_browsing/safe_browsing_blocking_page.cc
index 350cdb3153209..5796cb2497e10 100644
--- chrome/browser/safe_browsing/safe_browsing_blocking_page.cc
+++ chrome/browser/safe_browsing/safe_browsing_blocking_page.cc
@@ -63,8 +63,7 @@ class SafeBrowsingBlockingPageFactoryImpl
     PrefService* prefs =
         Profile::FromBrowserContext(web_contents->GetBrowserContext())
             ->GetPrefs();
-    bool is_extended_reporting_opt_in_allowed =
-        IsExtendedReportingOptInAllowed(*prefs);
+    bool is_extended_reporting_opt_in_allowed = false;
     bool is_proceed_anyway_disabled =
         prefs->GetBoolean(prefs::kSafeBrowsingProceedAnywayDisabled);
 
diff --git chrome/browser/safe_browsing/safe_browsing_service.cc chrome/browser/safe_browsing/safe_browsing_service.cc
index 0c70a941f7ba8..9b4faa5144f80 100644
--- chrome/browser/safe_browsing/safe_browsing_service.cc
+++ chrome/browser/safe_browsing/safe_browsing_service.cc
@@ -247,7 +247,7 @@ SafeBrowsingUIManager* SafeBrowsingService::CreateUIManager() {
 }
 
 void SafeBrowsingService::RegisterAllDelayedAnalysis() {
-#if BUILDFLAG(FULL_SAFE_BROWSING)
+#if 0
   RegisterBinaryIntegrityAnalysis();
 #endif
 }
diff --git components/security_interstitials/core/safe_browsing_loud_error_ui.cc components/security_interstitials/core/safe_browsing_loud_error_ui.cc
index a375f46bc9203..7ba1829b9cc1d 100644
--- components/security_interstitials/core/safe_browsing_loud_error_ui.cc
+++ components/security_interstitials/core/safe_browsing_loud_error_ui.cc
@@ -23,6 +23,7 @@ namespace {
 // For malware interstitial pages, we link the problematic URL to Google's
 // diagnostic page.
 const char kSbDiagnosticUrl[] =
+/* trk:227 */
     "https://transparencyreport.google.com/safe-browsing/search?url=%s";
 
 // Constants for the V4 phishing string upgrades.
-- 
2.29.1

